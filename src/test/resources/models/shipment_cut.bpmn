<?xml version="1.0" encoding="UTF-8"?>
<bpmn:definitions xmlns:bpmn="http://www.omg.org/spec/BPMN/20100524/MODEL" xmlns:bpmndi="http://www.omg.org/spec/BPMN/20100524/DI" xmlns:dc="http://www.omg.org/spec/DD/20100524/DC" xmlns:di="http://www.omg.org/spec/DD/20100524/DI" xmlns:zeebe="http://camunda.org/schema/zeebe/1.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:bioc="http://bpmn.io/schema/bpmn/biocolor/1.0" xmlns:color="http://www.omg.org/spec/BPMN/non-normative/color/1.0" xmlns:modeler="http://camunda.org/schema/modeler/1.0" xmlns:camunda="http://camunda.org/schema/1.0/bpmn" id="Definitions_1" targetNamespace="http://bpmn.io/schema/bpmn" exporter="Camunda Modeler" exporterVersion="5.5.1" modeler:executionPlatform="Camunda Cloud" modeler:executionPlatformVersion="8.0.0" camunda:diagramRelationId="d6e859f5-bbfc-469e-8597-f8f1bb97af6b">
  <bpmn:process id="Shipment_with_activity" name="Shipment" isExecutable="true">
    <bpmn:endEvent id="Event_1x7ojdn" name="Shipment&#38;#10;finalized">
      <bpmn:incoming>Flow_14d86vs</bpmn:incoming>
    </bpmn:endEvent>
    <bpmn:sequenceFlow id="Flow_18ui8qp" sourceRef="StartEvent_Preadvice" targetRef="Gateway_JoinAfterStart" />
    <bpmn:subProcess id="Activity_03jfohc" triggeredByEvent="true">
      <bpmn:startEvent id="Event_06wf1r6" name="Duplicate preadvice received" isInterrupting="false">
        <bpmn:outgoing>Flow_02llgw9</bpmn:outgoing>
        <bpmn:messageEventDefinition id="MessageEventDefinition_0lpwwpo" messageRef="Message_0rp5u92" />
      </bpmn:startEvent>
      <bpmn:endEvent id="Event_12t96zb" name="Duplicate preadvice&#38;#10;ignored">
        <bpmn:incoming>Flow_02llgw9</bpmn:incoming>
      </bpmn:endEvent>
      <bpmn:sequenceFlow id="Flow_02llgw9" sourceRef="Event_06wf1r6" targetRef="Event_12t96zb" />
    </bpmn:subProcess>
    <bpmn:businessRuleTask id="Activity_1rxbj1r" name="Determine redirection&#38;#10;options">
      <bpmn:extensionElements>
        <zeebe:calledDecision decisionId="redirectionOptions" resultVariable="redirectionOptions" />
      </bpmn:extensionElements>
      <bpmn:incoming>Flow_1w7jx0q</bpmn:incoming>
      <bpmn:outgoing>Flow_0amaeef</bpmn:outgoing>
    </bpmn:businessRuleTask>
    <bpmn:sequenceFlow id="Flow_0amaeef" sourceRef="Activity_1rxbj1r" targetRef="Event_035j9su" />
    <bpmn:startEvent id="Event_05bco1v" name="Planned&#38;#10;pickup">
      <bpmn:outgoing>Flow_0x430up</bpmn:outgoing>
      <bpmn:messageEventDefinition id="MessageEventDefinition_1ff7a2s" messageRef="Message_3lj691l" />
    </bpmn:startEvent>
    <bpmn:exclusiveGateway id="Gateway_JoinAfterStart">
      <bpmn:incoming>Flow_18ui8qp</bpmn:incoming>
      <bpmn:incoming>Flow_0x430up</bpmn:incoming>
      <bpmn:outgoing>Flow_1e0avz9</bpmn:outgoing>
    </bpmn:exclusiveGateway>
    <bpmn:sequenceFlow id="Flow_1e0avz9" sourceRef="Gateway_JoinAfterStart" targetRef="Activity_1p4nkfs" />
    <bpmn:sequenceFlow id="Flow_0x430up" sourceRef="Event_05bco1v" targetRef="Gateway_JoinAfterStart" />
    <bpmn:endEvent id="Event_1x1zr5w" name="Shipment&#38;#10;cancelled">
      <bpmn:incoming>Flow_1cxs4ko</bpmn:incoming>
    </bpmn:endEvent>
    <bpmn:endEvent id="Event_035j9su" name="Redirection finished">
      <bpmn:extensionElements>
        <zeebe:taskDefinition type="=&#34;redirectionOptions_&#34; + transactionId" />
      </bpmn:extensionElements>
      <bpmn:incoming>Flow_0amaeef</bpmn:incoming>
      <bpmn:messageEventDefinition id="MessageEventDefinition_1yjdxok" />
    </bpmn:endEvent>
    <bpmn:startEvent id="StartEvent_Preadvice" name="Preadvice">
      <bpmn:outgoing>Flow_18ui8qp</bpmn:outgoing>
      <bpmn:messageEventDefinition id="MessageEventDefinition_0rftyop" messageRef="Message_0rp5u92" />
    </bpmn:startEvent>
    <bpmn:callActivity id="Activity_1p4nkfs" name="deliver parcel">
      <bpmn:extensionElements>
        <zeebe:calledElement processId="deliver-parcel" propagateAllChildVariables="false" />
      </bpmn:extensionElements>
      <bpmn:incoming>Flow_1e0avz9</bpmn:incoming>
      <bpmn:outgoing>Flow_14d86vs</bpmn:outgoing>
      <bpmn:multiInstanceLoopCharacteristics>
        <bpmn:extensionElements>
          <zeebe:loopCharacteristics inputCollection="=parcelIds" inputElement="parcelId" />
        </bpmn:extensionElements>
      </bpmn:multiInstanceLoopCharacteristics>
    </bpmn:callActivity>
    <bpmn:boundaryEvent id="Event_0pumrqg" name="Redirection of entire shipment desired" cancelActivity="false" attachedToRef="Activity_1p4nkfs">
      <bpmn:outgoing>Flow_1w7jx0q</bpmn:outgoing>
      <bpmn:messageEventDefinition id="MessageEventDefinition_1q6ly5v" messageRef="Message_17c7gd8" />
    </bpmn:boundaryEvent>
    <bpmn:sequenceFlow id="Flow_1w7jx0q" sourceRef="Event_0pumrqg" targetRef="Activity_1rxbj1r" />
    <bpmn:boundaryEvent id="Event_08gjnzs" name="Cancelled" attachedToRef="Activity_1p4nkfs">
      <bpmn:outgoing>Flow_1cxs4ko</bpmn:outgoing>
      <bpmn:messageEventDefinition id="MessageEventDefinition_1mmiuw0" messageRef="Message_357c336" />
    </bpmn:boundaryEvent>
    <bpmn:sequenceFlow id="Flow_1cxs4ko" sourceRef="Event_08gjnzs" targetRef="Event_1x1zr5w" />
    <bpmn:sequenceFlow id="Flow_14d86vs" sourceRef="Activity_1p4nkfs" targetRef="Event_1x7ojdn" />
    <bpmn:textAnnotation id="TextAnnotation_1f5t6gy">
      <bpmn:text>for each parcel ID</bpmn:text>
    </bpmn:textAnnotation>
    <bpmn:association id="Association_0mulr1c" sourceRef="Activity_1p4nkfs" targetRef="TextAnnotation_1f5t6gy" />
    <bpmn:textAnnotation id="TextAnnotation_1f2d0mz">
      <bpmn:text>Contains
list of
parcel IDs</bpmn:text>
    </bpmn:textAnnotation>
    <bpmn:association id="Association_07yln4k" sourceRef="StartEvent_Preadvice" targetRef="TextAnnotation_1f2d0mz" />
    <bpmn:association id="Association_18xtgqy" sourceRef="TextAnnotation_1f2d0mz" targetRef="Event_05bco1v" />
  </bpmn:process>
  <bpmn:message id="Message_0rp5u92" name="PREADVICE">
    <bpmn:extensionElements>
      <zeebe:subscription correlationKey="=transactionId" />
    </bpmn:extensionElements>
  </bpmn:message>
  <bpmn:message id="Message_3en9c2d" name="INTRANSIT">
    <bpmn:extensionElements>
      <zeebe:subscription correlationKey="=parcelId" />
    </bpmn:extensionElements>
  </bpmn:message>
  <bpmn:message id="Message_17c7gd8" name="Msg_RedirectionDesired">
    <bpmn:extensionElements>
      <zeebe:subscription correlationKey="=transactionId" />
    </bpmn:extensionElements>
  </bpmn:message>
  <bpmn:message id="Message_3lj691l" name="PLANNEDPICKUP" />
  <bpmn:message id="Message_1021fr4" name="INPICKUP">
    <bpmn:extensionElements>
      <zeebe:subscription correlationKey="=parcelId" />
    </bpmn:extensionElements>
  </bpmn:message>
  <bpmn:message id="Message_0ifd256" name="NOTPICKEDUP">
    <bpmn:extensionElements>
      <zeebe:subscription correlationKey="=parcelId" />
    </bpmn:extensionElements>
  </bpmn:message>
  <bpmn:message id="Message_357c336" name="CANCELED">
    <bpmn:extensionElements>
      <zeebe:subscription correlationKey="=transactionId" />
    </bpmn:extensionElements>
  </bpmn:message>
  <bpmn:message id="Message_0rgcss6" name="INDELIVERY">
    <bpmn:extensionElements>
      <zeebe:subscription correlationKey="=parcelId" />
    </bpmn:extensionElements>
  </bpmn:message>
  <bpmn:message id="Message_1ajgppj" name="NOTDELIVERED">
    <bpmn:extensionElements>
      <zeebe:subscription correlationKey="=parcelId" />
    </bpmn:extensionElements>
  </bpmn:message>
  <bpmn:message id="Message_26d1kva" name="DELIVEREDPS">
    <bpmn:extensionElements>
      <zeebe:subscription correlationKey="=parcelId" />
    </bpmn:extensionElements>
  </bpmn:message>
  <bpmn:message id="Message_16i96a0" name="DELIVERED">
    <bpmn:extensionElements>
      <zeebe:subscription correlationKey="=parcelId" />
    </bpmn:extensionElements>
  </bpmn:message>
  <bpmn:message id="Message_32qfe2t" name="INWAREHOUSE">
    <bpmn:extensionElements>
      <zeebe:subscription correlationKey="=parcelId" />
    </bpmn:extensionElements>
  </bpmn:message>
  <bpmn:message id="Message_015dh9d" name="FINAL">
    <bpmn:extensionElements>
      <zeebe:subscription correlationKey="=parcelId" />
    </bpmn:extensionElements>
  </bpmn:message>
  <bpmndi:BPMNDiagram id="BPMNDiagram_1">
    <bpmndi:BPMNPlane id="BPMNPlane_1" bpmnElement="Shipment_with_activity">
      <bpmndi:BPMNShape id="Event_1x7ojdn_di" bpmnElement="Event_1x7ojdn" bioc:stroke="#43a047" bioc:fill="#c8e6c9" color:background-color="#c8e6c9" color:border-color="#43a047">
        <dc:Bounds x="662" y="210" width="36" height="36" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="639" y="253" width="87" height="27" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Activity_166096n_di" bpmnElement="Activity_03jfohc" isExpanded="true">
        <dc:Bounds x="140" y="450" width="160" height="120" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Event_0h5bswq_di" bpmnElement="Event_06wf1r6">
        <dc:Bounds x="160" y="472" width="36" height="36" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="159" y="515" width="48" height="40" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Event_12t96zb_di" bpmnElement="Event_12t96zb">
        <dc:Bounds x="242" y="472" width="36" height="36" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="217" y="515" width="86" height="40" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNEdge id="Flow_02llgw9_di" bpmnElement="Flow_02llgw9">
        <di:waypoint x="196" y="490" />
        <di:waypoint x="242" y="490" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNShape id="BPMNShape_1n54pxh" bpmnElement="Activity_1rxbj1r">
        <dc:Bounds x="490" y="330" width="100" height="80" />
        <bpmndi:BPMNLabel />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Event_06z58jc_di" bpmnElement="Event_05bco1v">
        <dc:Bounds x="161" y="332" width="36" height="36" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="159" y="375" width="41" height="27" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Gateway_1tyvfpp_di" bpmnElement="Gateway_JoinAfterStart" isMarkerVisible="true">
        <dc:Bounds x="245" y="203" width="50" height="50" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Event_1x1zr5w_di" bpmnElement="Event_1x1zr5w" bioc:stroke="#e53935" bioc:fill="#ffcdd2" color:background-color="#ffcdd2" color:border-color="#e53935">
        <dc:Bounds x="372" y="352" width="36" height="36" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="348" y="395" width="87" height="27" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Event_1g6wodo_di" bpmnElement="Event_035j9su">
        <dc:Bounds x="662" y="352" width="36" height="36" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="652" y="395" width="56" height="27" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Event_0l25e4h_di" bpmnElement="StartEvent_Preadvice">
        <dc:Bounds x="161" y="210" width="36" height="36" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="155" y="253" width="49" height="14" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Activity_0r8vnnq_di" bpmnElement="Activity_1p4nkfs">
        <dc:Bounds x="360" y="188" width="100" height="80" />
        <bpmndi:BPMNLabel />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="TextAnnotation_1f5t6gy_di" bpmnElement="TextAnnotation_1f5t6gy">
        <dc:Bounds x="410" y="90" width="120" height="30" />
        <bpmndi:BPMNLabel />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="TextAnnotation_1f2d0mz_di" bpmnElement="TextAnnotation_1f2d0mz">
        <dc:Bounds x="250" y="110" width="70" height="55" />
        <bpmndi:BPMNLabel />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="BPMNShape_07h6d4w" bpmnElement="Event_08gjnzs">
        <dc:Bounds x="372" y="250" width="36" height="36" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="405" y="293" width="49" height="14" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Event_1aqyqna_di" bpmnElement="Event_0pumrqg">
        <dc:Bounds x="422" y="250" width="36" height="36" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="453" y="280" width="76" height="40" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNEdge id="Flow_18ui8qp_di" bpmnElement="Flow_18ui8qp">
        <di:waypoint x="197" y="228" />
        <di:waypoint x="245" y="228" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="BPMNEdge_0vnmuzz" bpmnElement="Flow_0amaeef">
        <di:waypoint x="590" y="370" />
        <di:waypoint x="662" y="370" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_1e0avz9_di" bpmnElement="Flow_1e0avz9">
        <di:waypoint x="295" y="228" />
        <di:waypoint x="360" y="228" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_0x430up_di" bpmnElement="Flow_0x430up">
        <di:waypoint x="197" y="350" />
        <di:waypoint x="270" y="350" />
        <di:waypoint x="270" y="253" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_1w7jx0q_di" bpmnElement="Flow_1w7jx0q">
        <di:waypoint x="440" y="286" />
        <di:waypoint x="440" y="370" />
        <di:waypoint x="490" y="370" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_1cxs4ko_di" bpmnElement="Flow_1cxs4ko">
        <di:waypoint x="390" y="286" />
        <di:waypoint x="390" y="352" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_14d86vs_di" bpmnElement="Flow_14d86vs">
        <di:waypoint x="460" y="228" />
        <di:waypoint x="662" y="228" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Association_0mulr1c_di" bpmnElement="Association_0mulr1c">
        <di:waypoint x="423" y="188" />
        <di:waypoint x="463" y="120" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Association_07yln4k_di" bpmnElement="Association_07yln4k">
        <di:waypoint x="190" y="214" />
        <di:waypoint x="250" y="138" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Association_18xtgqy_di" bpmnElement="Association_18xtgqy">
        <di:waypoint x="250" y="160" />
        <di:waypoint x="185" y="333" />
      </bpmndi:BPMNEdge>
    </bpmndi:BPMNPlane>
  </bpmndi:BPMNDiagram>
</bpmn:definitions>
